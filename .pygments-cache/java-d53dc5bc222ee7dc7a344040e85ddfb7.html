<div class="highlight"><pre><span class="cm">/* </span>
<span class="cm"> </span>
<span class="cm">CCLRun executes a Java program by loading it through a </span>
<span class="cm">CompilingClassLoader. </span>
<span class="cm"> </span>
<span class="cm">*/</span>  
  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CCLRun</span>  
<span class="o">{</span>  
  <span class="kd">static</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span> <span class="n">String</span> <span class="n">args</span><span class="o">[]</span> <span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>  
  
    <span class="c1">// The first argument is the Java program (class) the user  </span>
    <span class="c1">// wants to run  </span>
    <span class="n">String</span> <span class="n">progClass</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>  
  
    <span class="c1">// And the arguments to that program are just  </span>
    <span class="c1">// arguments 1..n, so separate those out into  </span>
    <span class="c1">// their own array  </span>
    <span class="n">String</span> <span class="n">progArgs</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="o">];</span>  
    <span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span> <span class="n">args</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">progArgs</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">progArgs</span><span class="o">.</span><span class="na">length</span> <span class="o">);</span>  
  
    <span class="c1">// Create a CompilingClassLoader  </span>
    <span class="n">CompilingClassLoader</span> <span class="n">ccl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompilingClassLoader</span><span class="o">();</span>  
  
    <span class="c1">// Load the main class through our CCL  </span>
    <span class="n">Class</span> <span class="n">clas</span> <span class="o">=</span> <span class="n">ccl</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span> <span class="n">progClass</span> <span class="o">);</span>  
  
    <span class="c1">// Use reflection to call its main() method, and to  </span>
    <span class="c1">// pass the arguments in.  </span>
  
    <span class="c1">// Get a class representing the type of the main method&#39;s argument  </span>
    <span class="n">Class</span> <span class="n">mainArgType</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="mi">0</span><span class="o">]).</span><span class="na">getClass</span><span class="o">()</span> <span class="o">};</span>  
  
    <span class="c1">// Find the standard main method in the class  </span>
    <span class="n">Method</span> <span class="n">main</span> <span class="o">=</span> <span class="n">clas</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span> <span class="s">&quot;main&quot;</span><span class="o">,</span> <span class="n">mainArgType</span> <span class="o">);</span>  
  
    <span class="c1">// Create a list containing the arguments -- in this case,  </span>
    <span class="c1">// an array of strings  </span>
    <span class="n">Object</span> <span class="n">argsArray</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">progArgs</span> <span class="o">};</span>  
  
    <span class="c1">// Call the method  </span>
    <span class="n">main</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span> <span class="kc">null</span><span class="o">,</span> <span class="n">argsArray</span> <span class="o">);</span>  
  <span class="o">}</span>  
<span class="o">}</span>
</pre></div>